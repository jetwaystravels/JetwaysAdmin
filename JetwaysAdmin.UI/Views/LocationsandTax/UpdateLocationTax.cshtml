@using JetwaysAdmin.Entity
@model JetwaysAdmin.Entity.LocationsandTax
@{
    Layout = "~/Views/Shared/OfficeLegalentity.cshtml";
    var Data = Model;
    var countryData = ViewBag.CountryList;
}
<main id="main" class="main">
    <div class="pcoded-main-container">
        <div class="pcoded-wrapper">
            <!-- Page-header start -->
            <div class="page-header">
                <div class="page-block">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="page-header-title">
                                <h5 class="m-b-10"> <a href="locations.html"><i class="fa fa-arrow-left mr-2" aria-hidden="true" style="vertical-align: text-top;"></i></a>Location Details</h5>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="#">Setting</a>
                                </li>
                                <li class="breadcrumb-item">
                                    <a href="#">Manage Customers</a>
                                </li>
                                <li class="breadcrumb-item">
                                    Locations and Tax
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Page-header end -->
            <div class="pcoded-inner-content">
                <div class="main-body">
                    <div class="page-wrapper">
                        <div class="page-body">
                            @if (TempData["updateLocation_message"] != null)
                            {
                                <div class="alert alert-success">
                                    @TempData["updateLocation_message"]
                                    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>

                                </div>
                            }
                            <div class="card">
                                <div class="card-block">
                                    <form asp-controller="LocationsandTax" asp-action="EditLocationTax" method="post" class="form-material form-row">
                                         <input type="hidden" id="LegalEntityCode" name="LegalEntityCode" value="@ViewBag.LegalEntityCode" />
                                        <input type="hidden" id="LegalEntityName" name="LegalEntityName" value="@ViewBag.LegalEntityName" />
                                        <input type="hidden" id="Id" name="IdLegal" value="@ViewBag.Id" />
                                        <input type="hidden" name="LocationID" value="@Data.LocationID" />
                                        <div class="form-group form-primary col-md-6">
                                            <input type="text" name="LocationName" value="@Data.LocationName" class="form-control" required>
                                            <span class="form-bar"></span>
                                            <label class="float-label">Location Name<span>*</span></label>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <input type="text" name="LocationCode" value="@Data.LocationCode" class="form-control">
                                            <span class="form-bar"></span>
                                            <label class="float-label">Location Code</label>
                                        </div>
                                        <div class="form-group form-primary col-md-6">
                                            <input type="text" name="AddressLine1" value="@Data.AddressLine1" class="form-control" required>
                                            <span class="form-bar"></span>
                                            <label class="float-label">Address Line 1<span>*</span></label>
                                        </div>
                                        <div class="form-group form-primary col-md-6">
                                            <input type="text" name="AddressLine2" value="@Data.AddressLine2" class="form-control">
                                            <span class="form-bar"></span>
                                            <label class="float-label">Address Line 2</label>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <select id="CountryId" name="Country" class="form-control fill" onchange="loadStates()" required>
                                                <option value="@Data.Country">@Data.Country</option>
                                                @foreach (var country in countryData ?? new List<Country>())
                                                {
                                                 <option value="@country.CountryID">@country.CountryName</option>
                                                }
                                            </select>
                                            <span class="form-bar"></span>
                                            <label class="float-label">Country<span>*</span></label>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <select id="StateId" name="State" class="form-control fill" onchange="loadCities()" required>
                                                <option value="@Data.State">@Data.State</option>
                                            </select>
                                            <span class="form-bar"></span>
                                            <label class="float-label">State<span>*</span></label>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <select id="CityId" name="City" class="form-control fill" required>
                                                <option value="@Data.City">@Data.City</option>
                                            </select>
                                            <span class="form-bar"></span>
                                            <label class="float-label">City<span>*</span></label>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <input type="text" name="PostalCode" value="@Data.PostalCode" class="form-control" required>
                                            <span class="form-bar"></span>
                                            <label class="float-label">Postal Code<span>*</span></label>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <input type="text" name="Latitude" value="@Data.Latitude" class="form-control">
                                            <span class="form-bar"></span>
                                            <label class="float-label">Latitude</label>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <input type="text" name="Longitude" value="@Data.Longitude" class="form-control">
                                            <span class="form-bar"></span>
                                            <label class="float-label">Longitude</label>
                                        </div>
                                        <div class="form-group form-primary col-md-3 m-t-15">
                                            <strong>Personal Booking</strong>
                                            <label class="switch m-l-5">
                                                <input type="checkbox" name="PersonalBooking" value="true">
                                                <span class="slider round"></span>
                                            </label>
                                        </div>

                                        <div class="form-group form-primary col-md-3 m-t-15">
                                            <strong>is SEZ?</strong>
                                            <label class="switch m-l-5">
                                                <input type="checkbox" name="IsSEZ" value="true">
                                                <span class="slider round"></span>
                                            </label>
                                        </div>

                                        <div class="form-group form-primary col-md-12 m-t-15">
                                            <div class="form-check form-check-inline m-r-30">
                                                <input class="form-check-input" type="radio" name="GSTRegistered" value="true">
                                                <label class="form-check-label" for="htmlEditor">
                                                    GST Registered
                                                </label>
                                            </div>

                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio"  name="UINRegistered" value="true">
                                                <label class="form-check-label" for="htmlEditor">
                                                    UIN Registered
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <input type="text" id="GSTNumber" name="GSTNumber" maxlength="15" minlength="15" value="@Data.GSTNumber" class="form-control" oninput="validateGSTNumber()" required>
                                            <span class="form-bar"></span>
                                            <label class="float-label">GST Number<span>*</span></label>
                                            <span id="GSTNumberError" style="color: red; font-size: 12px;"></span>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <input type="text" id="GSTName" name="GSTName" value="@Data.GSTName" class="form-control" oninput="validateGSTName()" required>
                                            <span class="form-bar"></span>
                                            <label class="float-label">GST Name<span>*</span></label>
                                            <span id="GSTNameError" style="color: red; font-size: 12px;"></span>
                                        </div>
                                        <div class="form-group form-primary col-md-3">
                                            <input type="text" id="GSTEmail" name="GSTEmail" class="form-control" value="@Data.GSTEmail" oninput="validateGSTEmail()" required>
                                            <span class="form-bar"></span>
                                            <label class="float-label">GST Email<span>*</span></label>
                                            <span id="GSTEmailError" style="color: red; font-size: 12px;"></span>
                                        </div>
                                        <div class="form-group form-primary col-md-1">
                                            <select class="select" name="MobileCountryCode">
                                                <option value="">IN(+91)</option>
                                                <option value="AF">AF (+93)</option>
                                                <option value="AL">AL (+355)</option>
                                                <option value="DZ">DZ (+213)</option>
                                                <option value="AO">AO (+244)</option>
                                                <option value="AR">AR (+54)</option>
                                                <option value="AM">AM (+374)</option>
                                                <option value="AW">AW (+297)</option>
                                                <option value="AU">AU (+61)</option>
                                                <option value="AZ">AZ (+994)</option>
                                            </select>
                                        </div>
                                        <div class="form-group form-primary col-md-2">
                                            <input type="text" name="MobileNumber" value="@Data.MobileNumber" id="mobile" minlength="10" maxlength="10" pattern="\d{10}" class="form-control" required>
                                            <span class="form-bar"></span>
                                            <label class="float-label">Mobile Number<span>*</span></label>
                                            <span id="merror" style="color: red;"></span>
                                        </div>
                                        <div class="form-group form-primary col-md-12 m-t-10" style="border-top:1px solid #dee2e6;"></div>
                                        <div class="form-group form-primary col-md-12">
                                            <button type="submit" class="btn btn-primary waves-effect waves-light">Update</button>
                                            <button type="button" class="btn btn-danger waves-effect waves-light">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                 </div>
                <div id="styleSelector"> </div>
            </div>
        </div>
    </div>
</main>

<script>
    function loadStates() {
        var selectedCountryId = document.getElementById("CountryId").value;
        if (selectedCountryId) {
            fetch('/LocationsandTax/LoadStates?countryId=' + selectedCountryId, {
                method: 'GET'
            })
                .then(response => response.json())
                .then(states => {
                    const stateSelect = document.getElementById("StateId");
                    stateSelect.innerHTML = '<option value="">-- Select State --</option>';
                    states.forEach(function (state) {
                        const option = document.createElement("option");
                        option.value = state.stateID;
                        option.text = state.stateName;
                        stateSelect.appendChild(option);
                    });
                });
        }
    }
    function loadCities() {
        var stateId = document.getElementById("StateId").value;
        fetch('/LocationsandTax/LoadCities?stateId=' + stateId)
            .then(response => response.json())
            .then(cities => {
                var citySelect = document.getElementById("CityId");
                citySelect.innerHTML = '<option value="">-- Select City --</option>';

                cities.forEach(function (city) {
                    var option = document.createElement("option");
                    option.value = city.cityID;
                    option.text = city.cityName;
                    citySelect.appendChild(option);
                });
            });
    }
</script>
<script>
    function updateGSTValue() {
        const gstChecked = document.querySelector('input[name="GSTRegistered"]:checked');
        if (gstChecked && gstChecked.value === "true") {
            const uinRadio = document.querySelector('input[name="UINRegistered"]:checked');
            if (uinRadio) uinRadio.checked = false;
        }
        document.getElementById('GSTValue').value = gstChecked && gstChecked.value === "true" ? "G" : "";
        updateUINValue();
    }
    function updateUINValue() {
        const uinChecked = document.querySelector('input[name="UINRegistered"]:checked');
        if (uinChecked && uinChecked.value === "true") {
            const gstRadio = document.querySelector('input[name="GSTRegistered"]:checked');
            if (gstRadio) gstRadio.checked = false;
        }
        document.getElementById('UINValue').value = uinChecked && uinChecked.value === "true" ? "U" : "";
        updateGSTValue();
    }
    document.querySelectorAll('input[name="GSTRegistered"]').forEach(radio => {
        radio.addEventListener('change', updateGSTValue);
    });
    document.querySelectorAll('input[name="UINRegistered"]').forEach(radio => {
        radio.addEventListener('change', updateUINValue);
    });
    updateGSTValue();
    updateUINValue();
</script>
<script>
    function validateGSTNumber() {
        const gst = document.getElementById("GSTNumber").value.trim();
        const error = document.getElementById("GSTNumberError");
        const gstRegex = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;

        if (gst.length === 0) {
            error.textContent = "GST Number is required.";
        }
        else if (!gstRegex.test(gst)) {
            error.textContent = "Invalid GST Number format.";
        }
        else if (gst.length !== 15) {
            error.textContent = "GST Number must be exactly 15 characters.";
        }
        else {
            error.textContent = "";
        }
    }
    function validateGSTName() {
        const name = document.getElementById("GSTName").value.trim();
        const error = document.getElementById("GSTNameError");
        //const nameRegex = /^[A-Za-z\s]+$/;
        const nameRegex = /^[A-Za-z0-9\s]+$/;
        if (name.length === 0) {
            error.textContent = "GST Name is required.";
        } else if (!nameRegex.test(name)) {
            error.textContent = "GST Name must contain only letters.";
        } else {
            error.textContent = "";
        }
    }
    function validateGSTEmail() {
        const email = document.getElementById("GSTEmail").value.trim();
        const error = document.getElementById("GSTEmailError");
        const emailRegex = /^\w+([\.-]?\w+)*@@\w+([\.-]?\w+)*(\.\w{2,3})+$/;

        if (email.length === 0) {
            error.textContent = "GST Email is required.";
        } else if (!emailRegex.test(email)) {
            error.textContent = "Invalid email format.";
        } else {
            error.textContent = "";
        }
    }
</script>


<script>
    document.getElementById("mobile").addEventListener("input", function () {
        const mobile = this.value;
        const error = document.getElementById("merror");
        if (mobile.length > 10) {
            this.value = mobile.slice(0, 10);
        }
        if (mobile.length !== 10) {
            error.textContent = "Mobile number must be exactly 10 digits.";
        } else {
            error.textContent = "";
        }
    });
</script>